using System;
using System.IO;

namespace PS3_Image_Injector {
    public class DDSCreate {
        private static byte[] DDS_HEADER = {
            0x44, 0x44, 0x53, 0x20, 0x7C, 0x00, 0x00, 0x00, 0x07, 0x10, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x4E, 0x56, 0x54, 0x54, 0x08, 0x00, 0x02, 0x00, 0x20, 0x00, 0x00, 0x00,
            0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        };

        private static void AddHeader(short Width, short Height, byte[] buffer) {
            Array.Copy(DDS_HEADER, buffer, 0x80);

            //Add Height
            Array.Copy(BitConverter.GetBytes(Convert.ToUInt32(Height)), 0, buffer, 0x0C, 4);

            //Add Width
            Array.Copy(BitConverter.GetBytes(Convert.ToUInt32(Width)), 0, buffer, 0x10, 4);

            //Add Size
            Array.Copy(BitConverter.GetBytes(Convert.ToUInt32(buffer.Length - 0x80)), 0, buffer, 0x14, 4);

            //Add Type
            string Type = (buffer.Length - 0x80) == (Width * Height) ? "DXT5" : "DXT1";
            Array.Copy(System.Text.Encoding.ASCII.GetBytes(Type), 0, buffer, 0x54, 4);
        }

        public static byte[] CreateDDS(short Width, short Height, byte[] Data) {
            byte[] DDS = new byte[Data.Length + 0x80];

            AddHeader(Width, Height, DDS);

            Array.Copy(Data, 0, DDS, 0x80, Data.Length);

            return DDS;
        }
    }
}
